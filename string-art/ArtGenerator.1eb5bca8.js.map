{"mappings":"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","sources":["src/string-art/js/string_art_generator.js"],"sourcesContent":["function StringArtGenerator(canvas) {\n  this.InitCanvas(canvas);\n  this.InitSelectButton();\n  this.InitControls();\n  this.InitSave();\n  this.InitEvents();\n}\n\nStringArtGenerator.prototype.SelectImage = function (e) {\n  let files = this.fileInput.files;\n\n  if (files.length != 1) return;\n\n  let image = new Image();\n  image.onload = () => this.LoadImage(image);\n  image.src = URL.createObjectURL(files[0]);\n\n  this.fileInput.value = \"\";\n};\n\nStringArtGenerator.prototype.LoadImage = function (image) {\n  this.image = image;\n  this.isLineDrawing = false;\n\n  this.Reset();\n\n  if (this.formType === undefined || this.formType == IMAGE_FORM) {\n    this.formType = this.formTypeBox.value;\n    this.InitNails();\n  }\n\n  this.generateBtn.removeAttribute(\"disabled\");\n};\n\nStringArtGenerator.prototype.UpdateForm = function () {\n  let needInitArt = this.formType != this.formTypeBox.value;\n  this.formType = this.formTypeBox.value;\n\n  this.InitBbox();\n  this.DrawLoadedImage();\n\n  if (needInitArt) this.InitNails();\n};\n\nStringArtGenerator.prototype.ToSignString = function (value) {\n  if (value > 0) return `+${value}`;\n\n  if (value < 0) return `-${-value}`;\n\n  return \"0\";\n};\n\nStringArtGenerator.prototype.UpdateContrast = function () {\n  let value = +this.contrastBox.value;\n  let contrast = 1 + value / 100;\n\n  this.contrastValue.innerHTML = this.ToSignString(value);\n  this.contrastTable = [];\n\n  for (let i = 0; i < 256; i++)\n    this.contrastTable[i] = this.LimitPixel((i - 128) * contrast + 128);\n};\n\nStringArtGenerator.prototype.UpdateBrightness = function () {\n  let value = +this.brightnessBox.value;\n  let brightness = 1 + value / 100;\n\n  this.brightnessValue.innerHTML = this.ToSignString(+this.brightnessBox.value);\n  this.brightnessTable = [];\n\n  for (let i = 0; i < 256; i++)\n    this.brightnessTable[i] = this.LimitPixel(i * brightness);\n};\n\nStringArtGenerator.prototype.UpdateWeight = function () {\n  let value = +this.linesWeightBox.value;\n  this.linesWeightValue.innerHTML = `${value}%`;\n};\n\nStringArtGenerator.prototype.GetPixels = function () {\n  this.pixelCtx.drawImage(this.canvas, 0, 0, this.width, this.height);\n  let data = this.pixelCtx.getImageData(0, 0, this.width, this.height).data;\n  let pixels = [];\n\n  for (let i = 0; i < data.length; i += 4)\n    pixels.push(this.GetLightness(data[i], data[i + 1], data[i + 2]));\n\n  return pixels;\n};\n\nStringArtGenerator.prototype.GetLineLightness = function (line) {\n  let lightness = 0;\n\n  for (let index of line) lightness += this.pixels[index];\n\n  return lightness / line.size;\n};\n\nStringArtGenerator.prototype.GetNextNail = function (nail) {\n  let nextNail = nail;\n  let nextLine = null;\n  let minLightness = Infinity;\n\n  for (let i = 0; i < this.nails.length; i++) {\n    if (i == nail) continue;\n\n    let line = this.LineRasterization(\n      this.nails[i].x,\n      this.nails[i].y,\n      this.nails[nail].x,\n      this.nails[nail].y\n    );\n    let lightness = this.GetLineLightness(line);\n\n    if (lightness < minLightness) {\n      minLightness = lightness;\n      nextNail = i;\n      nextLine = line;\n    }\n  }\n\n  return {\n    nail: nextNail,\n    line: nextLine,\n  };\n};\n\nStringArtGenerator.prototype.RemoveLine = function (line, lineWeight) {\n  for (let index of line)\n    this.pixels[index] = Math.min(\n      255,\n      this.pixels[index] + lineWeight * this.dpr\n    );\n};\n\nStringArtGenerator.prototype.TimeToString = function (delta) {\n  delta = Math.floor(delta);\n\n  let milliseconds = `${delta % 1000}`.padStart(3, \"0\");\n  let seconds = `${Math.floor(delta / 1000) % 60}`.padStart(2, \"0\");\n  let minutes = `${Math.floor(delta / 60000)}`.padStart(2, \"0\");\n\n  return `${minutes}:${seconds}.${milliseconds}`;\n};\n\nStringArtGenerator.prototype.ShowInfo = function (\n  linesCount,\n  totalCount,\n  startTime\n) {\n  let currTime = performance.now();\n  let time = this.TimeToString(currTime - startTime);\n  let lost = this.TimeToString(\n    ((currTime - startTime) / (totalCount - linesCount)) * linesCount\n  );\n  let avg = ((currTime - startTime) / (totalCount - linesCount)).toFixed(2);\n\n  this.infoBox.innerHTML = `<b>Осталось линий:</b> ${linesCount}<br>`;\n  this.infoBox.innerHTML += `<b>Прошло времени:</b> ${time}<br>`;\n  this.infoBox.innerHTML += `<b>Осталось времени:</b> ${lost}<br>`;\n  this.infoBox.innerHTML += `<b>Ср. время линии:</b> ${avg} мс`;\n};\n\nStringArtGenerator.prototype.GetActions = function () {\n  let actions = \"<b>Основные действия:</b><br>\";\n\n  if (\"ontouchstart\" in window) {\n    actions += \"<b>Масштабирование</b> - щипок<br>\";\n    actions += \"<b>Перемещение</b> - касание\";\n  } else {\n    actions += \"<b>Масштабирование</b> - скроллинг<br>\";\n    actions += \"<b>Перемещение</b> - левая кнопка мыши\";\n  }\n\n  return actions;\n};\n\nStringArtGenerator.prototype.GetLineWeight = function () {\n  return this.LimitPixel((+this.linesWeightBox.value / 100) * 255);\n};\n\nStringArtGenerator.prototype.GetLineColor = function () {\n  let color = this.linesColorBox.value;\n  let weight = this.GetLineWeight();\n\n  return `${color}${weight.toString(16).padStart(2, \"0\")}`;\n};\n\nStringArtGenerator.prototype.ResetImage = function () {\n  this.imgWidth = this.image.width;\n  this.imgHeight = this.image.height;\n  let aspectRatio = this.imgWidth / this.imgHeight;\n\n  if (this.imgWidth > this.imgHeight) {\n    this.imgWidth = this.width;\n    this.imgHeight = Math.round(this.width / aspectRatio);\n  } else {\n    this.imgHeight = this.height;\n    this.imgWidth = Math.round(this.imgHeight * aspectRatio);\n  }\n\n  this.imgX = 0;\n  this.imgY = 0;\n  this.imgScale = 1;\n\n  this.InitBbox();\n};\n\nStringArtGenerator.prototype.Reset = function (needResetImage = true) {\n  if (needResetImage) this.ResetImage();\n\n  this.saveBox.style.display = \"none\";\n  this.infoBox.innerHTML = this.GetActions();\n  this.isGenerating = false;\n  this.isLineDrawing = false;\n\n  for (let control of this.controls) control.removeAttribute(\"disabled\");\n\n  this.DrawLoadedImage();\n};\n\nStringArtGenerator.prototype.StartGenerate = function () {\n  this.isGenerating = !this.isGenerating;\n\n  if (!this.isGenerating) return;\n\n  this.saveBox.style.display = \"none\";\n  this.infoBox.innerHTML = \"\";\n\n  if (!this.isLineDrawing) {\n    this.sequence = [];\n    this.DrawLoadedImage();\n\n    this.pixels = this.GetPixels();\n    this.isLineDrawing = true;\n    this.Clear(this.ctx);\n    this.DrawNails();\n  }\n\n  for (let control of this.controls) control.setAttribute(\"disabled\", \"\");\n\n  this.generateBtn.value = \"Прервать\";\n};\n\nStringArtGenerator.prototype.EndGenerate = function () {\n  this.saveBox.style.display = \"\";\n  this.isGenerating = false;\n  this.generateBtn.value = \"Запустить\";\n\n  this.resetBtn.removeAttribute(\"disabled\");\n  this.selectBtn.removeAttribute(\"disabled\");\n  this.linesCountBox.removeAttribute(\"disabled\");\n};\n\nStringArtGenerator.prototype.GenerateIteration = function (\n  nail,\n  linesCount,\n  totalCount,\n  lineWeight,\n  lineColor,\n  startTime\n) {\n  this.sequence.push(nail);\n  if (this.isDraw) this.ShowInfo(linesCount, totalCount, startTime);\n\n  if (linesCount == 0 || !this.isGenerating) {\n    this.EndGenerate();\n    return;\n  }\n\n  let next = this.GetNextNail(nail);\n  this.RemoveLine(next.line, lineWeight);\n  if (this.isDraw)\n    this.DrawLine(this.nails[nail], this.nails[next.nail], lineColor);\n\n  window.requestAnimationFrame(() =>\n    this.GenerateIteration(\n      next.nail,\n      linesCount - 1,\n      totalCount,\n      lineWeight,\n      lineColor,\n      startTime\n    )\n  );\n};\n\nStringArtGenerator.prototype.Generate = function () {\n  this.StartGenerate();\n\n  let linesCount = +this.linesCountBox.value;\n  let lineWeight = this.GetLineWeight();\n  let lineColor = this.GetLineColor();\n  let startTime = performance.now();\n\n  this.GenerateIteration(\n    0,\n    linesCount,\n    linesCount,\n    lineWeight,\n    lineColor,\n    startTime\n  );\n};\n\nStringArtGenerator.prototype.ToStringArt = function () {\n  return JSON.stringify(\n    {\n      nails: this.nails,\n      color: this.GetLineColor(),\n      background: this.backgroundColorBox.value,\n      sequence: this.sequence,\n    },\n    null,\n    \"    \"\n  );\n};\n\nStringArtGenerator.prototype.ToTxt = function () {\n  let result = ``;\n  for (let elem of this.sequence) {\n    result += elem + `\\n`;\n  }\n  return result;\n};\n\nStringArtGenerator.prototype.ToSVG = function () {\n  let svg = `<svg viewBox=\"0 0 ${this.width} ${this.height}\" width=\"512\" height=\"512\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\\n`;\n\n  if (this.formType == CIRCLE_FORM) {\n    svg += `    <circle cx=\"${this.x0}\" cy=\"${this.y0}\" r=\"${\n      this.radius + PADDING / 2\n    }\" fill=\"${this.backgroundColorBox.value}\" />\\n`;\n  } else {\n    let x = this.imgBbox.xmin;\n    let y = this.imgBbox.ymin;\n    let width = this.imgBbox.xmax - this.imgBbox.xmin;\n    let height = this.imgBbox.ymax - this.imgBbox.ymin;\n\n    svg += `    <rect x=\"${x}\" y=\"${y}\" width=\"${width}\" height=\"${height}\" fill=\"${this.backgroundColorBox.value}\" />\\n`;\n  }\n\n  for (let nail of this.nails)\n    svg += `    <circle cx=\"${nail.x}\" cy=\"${nail.y}\" r=\"${NAIL_RADIUS}\" fill=\"${NAIL_COLOR}\" />\\n`;\n\n  for (let i = 1; i < this.sequence.length; i++) {\n    let p1 = this.nails[this.sequence[i - 1]];\n    let p2 = this.nails[this.sequence[i]];\n\n    svg += `    <path d=\"M ${p1.x} ${p1.y} L ${p2.x} ${\n      p2.y\n    }\" line-width=\"1\" stroke=\"${this.GetLineColor()}\" fill=\"none\" />\\n`;\n  }\n\n  svg += \"</svg>\";\n\n  return svg;\n};\n\nStringArtGenerator.prototype.Save = function () {\n  let type = this.saveTypeBox.value;\n  let link = document.createElement(\"a\");\n\n  if (type == \"stringart\") {\n    link.href = URL.createObjectURL(\n      new Blob([this.ToStringArt()], { type: \"application/json\" })\n    );\n    link.download = \"art.stringart\";\n  } else if (type == \"save\") {\n    localStorage.setItem(\"dataPoint\", JSON.stringify(this.ToTxt().join(\"\\n\")));\n    return;\n  } else if (type == \"png\") {\n    link.href = this.canvas.toDataURL();\n    link.download = \"art.png\";\n  } else if (type == \"svg\") {\n    link.href = URL.createObjectURL(new Blob([this.ToSVG()], { type: \"svg\" }));\n    link.download = \"art.svg\";\n  } else if (type == \"txt\") {\n    link.href = URL.createObjectURL(\n      new Blob([this.ToTxt()], { type: \"text/plain;charset=utf-8\" })\n    );\n    link.download = \"art.txt\";\n  }\n\n  link.click();\n};\n\nStringArtGenerator.prototype.SetScale = function (scale, x, y) {\n  let dx = (x - this.imgX) / this.imgScale;\n  let dy = (y - this.imgY) / this.imgScale;\n\n  this.imgScale = scale;\n  this.imgX = x - dx * this.imgScale;\n  this.imgY = y - dy * this.imgScale;\n};\n"],"names":["StringArtGenerator","canvas","this","InitCanvas","InitSelectButton","InitControls","InitSave","InitEvents","prototype","SelectImage","e","files","fileInput","length","image","Image","onload","LoadImage","src","URL","createObjectURL","value","isLineDrawing","Reset","undefined","formType","IMAGE_FORM","formTypeBox","InitNails","generateBtn","removeAttribute","UpdateForm","needInitArt","InitBbox","DrawLoadedImage","ToSignString","UpdateContrast","contrastBox","contrast","contrastValue","innerHTML","contrastTable","i","LimitPixel","UpdateBrightness","brightness","brightnessBox","brightnessValue","brightnessTable","UpdateWeight","linesWeightBox","linesWeightValue","GetPixels","pixelCtx","drawImage","width","height","data","getImageData","pixels","push","GetLightness","GetLineLightness","line","lightness","index","size","GetNextNail","nail","nextNail","nextLine","minLightness","Infinity","nails","LineRasterization","x","y","RemoveLine","lineWeight","Math","min","dpr","TimeToString","delta","milliseconds","floor","padStart","seconds","ShowInfo","linesCount","totalCount","startTime","currTime","performance","now","time","lost","avg","toFixed","infoBox","GetActions","actions","window","GetLineWeight","GetLineColor","linesColorBox","toString","ResetImage","imgWidth","imgHeight","aspectRatio","round","imgX","imgY","imgScale","needResetImage","saveBox","style","display","isGenerating","control","controls","StartGenerate","sequence","Clear","ctx","DrawNails","setAttribute","EndGenerate","resetBtn","selectBtn","linesCountBox","GenerateIteration","lineColor","isDraw","next","DrawLine","requestAnimationFrame","Generate","ToStringArt","JSON","stringify","color","background","backgroundColorBox","ToTxt","result","elem","ToSVG","svg","CIRCLE_FORM","x0","y0","radius","PADDING","imgBbox","xmin","ymin","xmax","ymax","NAIL_RADIUS","NAIL_COLOR","p1","p2","Save","type","saveTypeBox","link","document","createElement","href","Blob","download","localStorage","setItem","join","toDataURL","click","SetScale","scale","dx","dy"],"version":3,"file":"ArtGenerator.1eb5bca8.js.map"}